name: Test Notify

on:
  repository_dispatch:
    types: [test-notify]

jobs:
  echo-dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: Format Slack message
        id: format
        run: |
          NOTIFY_TYPE="${{ github.event.client_payload.notify_type }}"
          AUTHOR="${{ github.event.client_payload.author }}"
          PR_NUMBER="${{ github.event.client_payload.pull_request.number }}"
          PR_TITLE="${{ github.event.client_payload.pull_request.title }}"
          PR_URL="${{ github.event.client_payload.pull_request.url }}"

          # é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆï¼ˆå¿…è¦ãªã‚‰switchçš„ã«å‡ºã—åˆ†ã‘ã¦ã‚‚OKï¼‰
          case "$NOTIFY_TYPE" in
            auto-create-pr-merge-action-required)
              EMOJI="â˜‘ï¸"
              MESSAGE="*${PR_TITLE}* ã®PRãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼ˆãƒãƒ¼ã‚¸å¯¾å¿œãŒå¿…è¦ã§ã™ï¼‰"
              ;;
            *)
              EMOJI="â„¹ï¸"
              MESSAGE="é€šçŸ¥ã‚¿ã‚¤ãƒ—: ${NOTIFY_TYPE} ã®PRé€šçŸ¥ã§ã™"
              ;;
          esac

          TEXT="${EMOJI} ${MESSAGE}\nğŸ”— <${PR_URL}|#${PR_NUMBER}> by @${AUTHOR}"
          echo "payload_text<<EOF" >> $GITHUB_OUTPUT
          echo "$TEXT" >> $GITHUB_OUTPUT
          echo "EOF" >>
