name: Test Notify

on:
  repository_dispatch:
    types: [test-notify]

jobs:
  echo-dispatch:
    runs-on: ubuntu-latest
    steps:
      - name: Format Slack message
        id: format
        run: |
          NOTIFY_TYPE="${{ github.event.client_payload.notify_type }}"
          AUTHOR="${{ github.event.client_payload.author }}"
          PR_NUMBER="${{ github.event.client_payload.pull_request.number }}"
          PR_TITLE="${{ github.event.client_payload.pull_request.title }}"
          PR_URL="${{ github.event.client_payload.pull_request.url }}"

          # 通知メッセージを作成（必要ならswitch的に出し分けてもOK）
          case "$NOTIFY_TYPE" in
            auto-create-pr-merge-action-required)
              EMOJI="☑️"
              MESSAGE="*${PR_TITLE}* のPRが作成されました（マージ対応が必要です）"
              ;;
            *)
              EMOJI="ℹ️"
              MESSAGE="通知タイプ: ${NOTIFY_TYPE} のPR通知です"
              ;;
          esac

          TEXT="${EMOJI} ${MESSAGE}\n🔗 <${PR_URL}|#${PR_NUMBER}> by @${AUTHOR}"
          echo "payload_text<<EOF" >> $GITHUB_OUTPUT
          echo "$TEXT" >> $GITHUB_OUTPUT
          echo "EOF" >>
